name:  Build JAR File

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: 'JDK 22'
      uses: oracle-actions/setup-java\@v1
      with:
        website: jdk.java.net

    - name: Download from Maven
      run: mvn package

    - name: Build with Maven
      run: mvn package

    - name: Install Tree
      run:
        sudo apt install tree

    - name: Tree
      run:
        tree -h

    - name: Upload JAR artifact
      uses: actions/upload-artifact@v2
      with:
        name: taskmanagerapp
        path: target

    - name: Release JAR file
      uses: "marvinpinto/action-automatic-releases@latest"
      with:
        repo_token: "${{ secrets.GITHUB_TOKEN }}"
        automatic_release_tag: "latest"
        title: "Task Manager"
        files: |
          target/TaskManager-0.0.1-SNAPSHOT.jar        

    - uses: actions/checkout\@v3
      with:
        repository: philiprbrenan/DataTableText
        path: dtt

    - uses: actions/checkout\@v3
      with:
        repository: philiprbrenan/GithubCrud
        path: gh

    - name: Cpan
      run:  sudo cpan install -T Data::Dump  Digest::SHA1

    - name: Upload JAR file
      env:
        GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
      run: |
        perl -Idtt/lib -Igh/lib -M"GitHub::Crud" -e"GitHub::Crud::writeBinaryFileFromFileInCurrentRun('tm.jar', 'target/TaskManager-0.0.1-SNAPSHOT.jar')"



